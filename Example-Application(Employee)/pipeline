pipeline {
    agent any 
    stages{
        stage('Clean Workspace') {
            steps {
                cleanWs()
            }
        }
        stage('Code') {
            steps {
                git branch:'main', url:'https://github.com/avinashdevops0/Kubernetes_Projects.git'
            }
        }
        stage('Build images') {
            steps{
                dir('Example-Application(Employee)') {
                    sh 'docker image build -t be ./backend'
                    sh 'docker tag be avinashg0/employee:be-${BUILD_NUMBER}'
                    sh 'docker image build -t fe ./frontend'
                    sh 'docker tag fe avinashg0/employee:fe-${BUILD_NUMBER}'
                }
            }
        }
        stage('Login and Push') {
            steps {
                // This step should not normally be used in your script. Consult the inline help for details.
                withDockerRegistry(credentialsId: 'DOCKER_HUB', url: 'https://index.docker.io/v1/') {
                sh 'docker push avinashg0/employee:be-${BUILD_NUMBER}'
                sh 'docker push avinashg0/employee:fe-${BUILD_NUMBER}'
                }
            }
        }
    }
}